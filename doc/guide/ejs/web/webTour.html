<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- BeginDsi "dsi/head.html" -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Embedthis Ejscript 0.9.8 Documentation</title>
    <meta name="keywords" content="Ejscript, JavaScript, ECMAScript, Server-Side JavaScript, Dynamic languages, 
        Embedded, AJAX, language"/>
	<meta name="description" content="Ejscript -- Embedded Server-Side JavaScript Language."/>
	<meta name="robots" content="index,follow" />
	<link href="../../../doc.css" rel="stylesheet" type="text/css" />
	<link href="../../../print.css" rel="stylesheet" type="text/css" media="print"/>
    <!--[if IE]>
    <link href="../../../iehacks.css" rel="stylesheet" type="text/css" />
    <![endif]-->
</head>

<body>
    <div class="top">
        <a class="logo"  href="http://www.ejscript.org/">&nbsp;</a>
        <div class="topRight">
             <div class="search">
                 <form method="get" action="http://www.google.com/search" title="Search www.embedthis.com">
                     <p>
                        <label title="Search">Search</label> 
                        <input type="text" id="q" name="q" size="15" maxlength="255" />
                        <input type="submit" id="submit" value="Go" /> 
                        <input type="hidden" name="domains" value="embedthis.com" /> 
                        <input type="hidden" name="sitesearch" value="embedthis.com" />
                    </p>
                 </form>
              </div>
            <!--TITLE-->Embedthis Ejscript 0.9.8
        </div>
        <div class="crumbs">
            <a href="../../../product/index.html">Home</a>
<!-- EndDsi -->
             &gt; <a href="index.html">Web Framework</a> &gt; <b>Web Framework Tour</b>
        </div>
    </div>
    <div class="content">
        <div class="contentRight">
            <h2>Quick Nav</h2>
            <ul>
                <li><a href="#blog">Blog App</a></li>
                <li><a href="#create">Creating a New App</a></li>
                <li><a href="#run">Run the App</a></li>
                <li><a href="#hello">Hello World</a></li>
                <li><a href="#dynamic">Dynamic Content</a></li>
                <li><a href="#scaffolds">Scaffolds</a></li>
                <li><a href="#newPosts">Create New Posts</a></li>
                <li><a href="#homePage">Edit the Home Page</a></li>
                <li><a href="#layout">Changing the Layout</a></li>
                <li><a href="#validations">Validations</a></li>
                <li><a href="#learn">Learn More</a></li>
            </ul>
<!-- BeginDsi "dsi/ejsWebSeeAlso.html" -->
		        <h2>See Also</h2>
		        <ul>
		          <li><a href="../../../guide/ejs/web/webTour.html">Web Framework Tour</a></li>
		          <li><a href="../../../guide/ejs/web/mvc.html">Model-View-Controller</a></li>
		          <li><a href="../../../guide/ejs/web/ejsweb.html">Application Generator</a></li>
		          <li><a href="../../../guide/ejs/web/controllers.html">Controllers and Actions</a></li>
		          <li><a href="../../../guide/ejs/web/views.html">Views and Layouts</a></li>
		          <li><a href="../../../guide/ejs/web/controls.html">Ajax View Controls</a></li>
		          <li><a href="../../../guide/ejs/web/models.html">Database Models</a></li>
		          <li><a href="../../../guide/ejs/web/hosting.html">Hosting in Web Servers</a></li>
		        </ul>
<!-- EndDsi -->
        </div>
        <div class="contentLeft">
            <h1>Ejscript Web Framework Tour</h1>
            <p>This will be a quick tour of the Ejscript Web Framework to give you an overview of the web framework and
            how to use it for your web applications.</p>
            <p>First make sure you have read the <a href="../users/quickStart.html">quick start</a> and the Ejscript
            language <a href="../users/tour.html">tour</a>, and that you have Ejscript installed on your system so you
            can type along as you go. This web framework tour will work with the Ejscript <a href=
            "../users/shell.html">command shell</a> and the web framework <a href="ejsweb.html">application
            generator</a> to run scripts.</p><a name="blog" id="blog"></a>
            <h2 class="section">A Demonstration Blog Application</h2>
            <p>This tour will describe the creation of a blog application. Command sessions are presented in blue
            boxes. Output from the system is highlighted in yellow. Bold yellow is used to highlight some output of
            specific interest.</p>
            <h2 class="section"><a name="create" id="create"></a>Creating a New Application</h2>
            <p>To create a new Ejscript application, you will use the <b>ejsweb</b>, Ejscript application generator
            program. Type the following ejsweb command in a command terminal window:</p>
            <pre>
<b>home&gt;</b> ejsweb -v generate app blog<b>
[CREATED] Directory: blog
[CREATED] Directory: blog/.tmp
[CREATED] Directory: blog/.ejs
[CREATED] Directory: blog/bin
[CREATED] Directory: blog/config
[CREATED] Directory: blog/controllers
[CREATED] Directory: blog/db
[CREATED] Directory: blog/doc
[CREATED] Directory: blog/logs
[CREATED] Directory: blog/models
[CREATED] Directory: blog/messages
[CREATED] Directory: blog/test
[CREATED] Directory: blog/src
[CREATED] Directory: blog/utils
[CREATED] Directory: blog/views
[CREATED] Directory: blog/views/layouts
[CREATED] Directory: blog/web
[CREATED] Directory: blog/web/images
[CREATED] Directory: blog/web/themes
[CREATED] Config File: "blog/config/config.ecf"
[CREATED] Config File: "blog/config/compiler.ecf"
[CREATED] Config File: "blog/config/database.ecf"
[CREATED] Config File: "blog/config/view.ecf"
[CREATED] Theme: "blog/web/themes/default.css"
[CREATED] Layout Style: "blog/web/layout.css"
[CREATED] Index: "blog/web/index.ejs"
[CREATED] Directory: blog/web/default
[CREATED] Web File: "blog/web/favicon.ico"
[CREATED] Web File: "blog/web/images/banner.jpg"
[CREATED] Web File: "blog/web/images/splash.jpg"
[CREATED] BaseController: "blog/controllers/Base.es"
[CREATED] Layout: "blog/views/layouts/default.ejs"
[CREATED] README: "blog/README"
[BUILD]   /Users/mob/hg/ejs/bin/ejsc --debug --web --out App.mod controllers/Base.es</b>
</pre>
            <p>This simple command accomplished quite a bit. It first created a new directory called <b>blog</b> for
            the application and then created subdirectories for various parts of the application. Most of these
            directories are initially empty, but they are created as a convenience for you as your application
            grows.</p>
            <p>The command also created a few configuration files in the config directory. These allow you to define
            database name, and other configuration settings.The Ejscript web framework follows the <i>"convention over
            configuration"</i> philosophy popularized by <a href="http://www.rubyonrails.org">Ruby on Rails</a>. This
            means that Ejscript adopts certain conventions about where files and directories should be and about how
            names are used. If you work with these conventions, then you need to do little or no configuration. Things
            will just work.</p>
            <p>Here are the most important directories:</p>
            <table summary="directories">
                <thead>
                    <tr>
                        <td>Name</td>
                        <td>Description</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>config</td>
                        <td>Application configuration files</td>
                    </tr>
                    <tr>
                        <td>controllers</td>
                        <td>Application controller classes</td>
                    </tr>
                    <tr>
                        <td>db</td>
                        <td>Database file and database initialization scripts</td>
                    </tr>
                    <tr>
                        <td>models</td>
                        <td>Database model classes</td>
                    </tr>
                    <tr>
                        <td>src</td>
                        <td>Application source code classes</td>
                    </tr>
                    <tr>
                        <td>views</td>
                        <td>View web pages</td>
                    </tr>
                    <tr>
                        <td>views/layouts</td>
                        <td>View layout template pages</td>
                    </tr>
                    <tr>
                        <td>web</td>
                        <td>Static web pages</td>
                    </tr>
                </tbody>
            </table>
            <p>See the <a href="ejsweb.html">ejsweb</a> documentation for an explanation about the other generated
            directories.</p><!--
            <p>The purpose of the other directories:</p>
            <table summary="directories">
                <thead>
                    <tr>
                        <td>Name</td><td>Description</td>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>.tmp</td><td>Temporary files</td></tr>
                    <tr><td>bin</td><td>Binary programs and tools</td></tr>
                    <tr><td>doc</td><td>Generated documentation for the application</td></tr>
                    <tr><td>logs</td><td>Application logs</td></tr>
                    <tr><td>messages</td><td>Message catalogues for internationalized applications</td></tr>
                    <tr><td>test</td><td>Unit tests</td></tr>
                    <tr><td>utils</td><td>Source for utility scripts and programs</td></tr>
                </tbody>
            </table>
-->
            <a name="run" id="run"></a>
            <h2 class="section">Running your Application</h2>
            <p>You can immediately run your application after generation. Ejscript includes a built-in web server so
            you can run your application without needing to deploy to an external web server. The Ejscript built-in web
            server is based on the <a href="http://www.appwebserver.org">Appweb</a> embedded web server which is a fast
            and compact server ideal for development and for production hosting. For more information about hosting
            Ejscript in web servers, read the <a href="hosting.html">Hosting</a> document.</p>
            <p>To run the web server:</p>
            <pre>
ejsweb run
<b>[RUN]: /usr/lib/ejs/appweb --home /usr/lib/ejs --ejs /:/var/www/blog/ --log /dev/tty:1
appweb: 1: Starting host named: "127.0.0.1:4000"
appweb: 1: HTTP services are ready (single-threaded)</b>
</pre>
            <p>Then enter <b>localhost:4000</b> in your browser and you should see your first application home
            page.</p><img src="../../../images/webtour-home.png" class="screen" height="80%" width="100%" alt="" />
            <a name="hello" id="hello"></a>
            <h2 class="section">Hello World</h2>
            <p>The next step is to create a simple "Hello World" web page. Ejscript web pages have an <b>.ejs</b>
            extension. Create a file called "hello.ejs" under the <b>web</b> directory with the following content:</p>
            <pre>
&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;Hello World&lt;/h1&gt;
&lt;/body&gt;
</pre>
            <p>To view the "Hello" web page in your browser, type in the following url:
            http://localhost:4000/web/hello.ejs.</p><img src="../../../images/webtour-hello.png" alt="hello" class=
            "screen" /> <a name="dynamic" id="dynamic"></a>
            <h2 class="section">Dynamic Content</h2>
            <p>While that was fun, the output is static and boring, so let's add some dynamic content. We can embed
            Ejscript expressions by including it inside a special Ejscript web page directive that will be executed and
            converted to HTML before sending to the client. There are a variety of server-side Ejscript web page
            directives, the one you'll use first is: <b>&lt;%= expression %&gt;</b>.</p>
            <p>To add the current date and time, modify the hello.ejs web page and add the highlighted line:</p>
            <pre>
&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;Hello World&lt;/h1&gt;
<b>Generated on &lt;%= Date() %&gt;</b>
&lt;/body&gt;
</pre>
            <p>Now when you re-run the page, it will display the current date and time:</p><img src=
            "../../../images/webtour-helloDate.png" alt="hello" class="screen" />
            <h3>No Restart Require</h3>
            <p>Notice that you did not have to re-start the web server, nor did you have to manually recompile the
            application. Rather, transparently in the background, the Ejscript web framework noticed that the hello.ejs
            web page was modified and it re-parsed and compiled it into an Ejscript module, ready for execution.</p>
            <p>We can also embed more complex Ejscript into our page, like:</p>
            <pre>
&lt;html&gt;
&lt;body&gt;
&lt;h3&gt;<b>&lt;% write("SERVER_SOFTWARE is " + host.software); %&gt;</b>
<b>&lt;% 
    for each (i in 200) {
        write(" Line: " + i + "\r\n")
    } 
%&gt;
</b>&lt;/body&gt;
</pre>
            <p>By using the Ejscript statement directive <b>&lt;% code %&gt;</b>, you can embed arbitrary Ejscript
            statements in your web page. The <b>write</b> function allows you to write arbitrary data which is patched
            back where the directive was defined in the page. See the <a href="views.html">Views and Layouts</a>
            document for full details about all the Ejscript web page directives.</p><a name="views" id="views"></a>
            <a name="scaffolds" id="scaffolds"></a>
            <h2 class="scaffolds">Scaffolds</h2>
            <p>Scaffolding is a quick way to generate major pieces of your application. The ejsweb command can generate
            database migrations, models, views and controllers for you. The command below will create a "Post" model
            with a blog post title and post comment body. The "title" is a string datatype and the "body" is a
            multi-line text field.</p>
            <pre>
ejsweb generate scaffold Post title:string body:text
<b>[CREATED] Directory: views/Post
[CREATED] Migration: "db/migrations/20090331134831_Create_Scaffold_Post.es"
[CREATED] Model: "models/Post.es"
[CREATED] Controller: "controllers/Post.es"
[CREATED] View: "views/Post/list.ejs"
[CREATED] View: "views/Post/edit.ejs"
[BUILD]: ejsc --web --out App.mod models/Post.es controllers/Base.es</b> 
</pre>
            <p>This command created a model for the Post under the models directory, and Post controller and "list" and
            "edit" views. It also created a database migration script to update the database and create a Post table
            with "title" and "body" columns.</p>
            <p>To run the migration and update the database, we use ejsweb again.</p>
            <pre>
ejsweb migrate
<b>[MIGRATE]: Apply 20090331134831_Create_Scaffold_Post.es</b>
</pre>
            <p>Now if you set your browser to the URL for the post controller, you will see your post listing screen.
            <img src="../../../images/webtour-postList.png" alt="postList" class="screen" /> <a name="newPosts" id=
            "newPosts"></a></p>
            <h2 class="section">Create New Posts</h2>
            <p>The new post button directs your browser to the <tt>/Post/list</tt> URL. Behind the scenes, Ejscript
            parses this URL and identifies "Post" as the name of the controler and "list" as the name of an action to
            invoke. The controller file <tt>controllers/Post.es</tt> defines the controller class to respond to this
            request.</p>
            <p>The controller class defines methods called actions, that are bound to URLs of the same name. Actions
            are defined using the <b>action</b> namespace qualifier to distinguish them from ordinary functions. When a
            request comes for a given action, the corresponding action method is invoked.</p>
            <h3>Actions</h3>
            <p>The job of the action is to respond to the request and generate the response via views for the
            client.</p>
            <pre>
public class PostController extends BaseController {
    public var post: Post
    use namespace action
    action function create() {
<b>        post = new Post
        renderView("edit")
</b>    }
    action function list() {}
}
</pre>
            <p>The <tt>create</tt> action creates a new Post instance and then uses the <tt>views/Post/edit.ejs</tt>
            view to generate the response. Ejscript <tt>edit</tt> scaffolds handle the work of both <tt>edit</tt> and
            <tt>create</tt> views because they are so similar.</p>
            <p>If an action does not call any of the <tt>render</tt> methods (as the <tt>list</tt> action does not),
            Ejscript will automatically invoke a view of the same name. In the case of the <tt>list</tt> action, the
            <tt>views/Post/list.ejs</tt> will be used to generate the response.</p><img src=
            "../../../images/webtour-createPost.png" alt="createPost" class="screen" />
            <p>Click OK to add the new blog post.</p><a name="homePage" id="homePage"></a>
            <h2>Edit the Home Page</h2>
            <p>You can edit the application's home page to add a link to your post listing page. Change
            <tt>web/index.ejs</tt> to contain just the following:</p>
            <pre>
&lt;%@ layout "default" %&gt;
&lt;h2&gt;&lt;% link("Goto My Blog", "/post") %&gt;&lt;/h2&gt;
</pre>
            <p>Then reload the page and you will see:</p><img src="../../../images/webtour-homeLink.png" alt="homeLink"
            class="screen" /> <a name="layout" id="layout"></a>
            <h2>Changing the Layout</h2>
            <p>Alternatively, you may wish to add some tabs to navigate your blog app. Ejscript provides a layout
            template engine that is used by all views to provide a common look and feel to your application. View pages
            leverage templates so they don't need to repeat page elements that are common across the application. Edit
            the master layout template file <tt>views/layouts/default.ejs</tt> and change it to use the <tt>tabs</tt>
            view control.</p>
            <pre>
&lt;body&gt;
    &lt;div class="top"&gt;
        &lt;h1&gt;&lt;a href="@@appUrl/"&gt;Blog Application&lt;/a&gt;&lt;/h1&gt;
<b>        &lt;% tabs([
           {"Blog Posts":  appUrl + "/post"},
            {"New Post": appUrl + "/post/create"},
        ]) %&gt;
</b>    &lt;/div&gt;
</pre>
            <p>This will create two tab buttons to navigate your application.</p>
            <p>After modifying the layout, you will need to re-compile the cached web pages. Normally, Ejscript
            transparently compiles the web pages into pure Ejscript byte-code for fast execution. It will automatically
            do this whenever you modify a view or controller. However, if you change a layout or model, you may need to
            recompile the app. This is easy to do via the ejsweb command.</p>
            <pre>
ejsweb compile
</pre><img src="../../../images/webtour-tabs.png" alt="tabs" class="screen" /> <a name="validations" id="validations">
            </a>
            <h2 class="section">Validations</h2>
            <p>Ejscript provides flexible validation methods to help ensure the data you save is correct.</p>
            <p>You can add calls to validate model data before it is saved to the database. Edit the
            <tt>models/Post.es</tt> file and add calls to <tt>validatePresence</tt> and <tt>validateUnique</tt>.</p>
            <pre>
public dynamic class Post implements Record {
    setup()
<b>    validatePresence(["title", "body"])
    validateUnique("title")</b>
</pre>
            <p>This will cause the model to automatically validate that the <tt>title</tt> and <tt>body</tt> fields are
            not blank and that the <tt>title</tt> is unique in the database. If you click OK without entering any data
            you will see the following:</p><img src="../../../images/webtour-validate.png" alt="tabs" class="screen" />
            <p>This automatically identified the input fields in error and generated a summary of the errors above the
            form. Of course, this default error highlighting behavior can be overridden if desired. Other validation
            methods include <tt>validateNumber</tt> and <tt>validateFormat</tt>. You can also supply a model method
            named <tt>validate</tt> that will be called for custom valiation. In the <tt>validate</tt> method you can
            fully validate your model data and call <tt>error</tt> for any fields that are invalid. For example:</p>
            <pre>
public function validate() {
    if (post.body.length &gt; 140) {
        error("body", "Body is too long")
    }
}
</pre><a name="learn" id="learn"></a>
            <h2 class="section">Learn More ...</h2>
            <p>That is a quick tour through some of the capabilities of Ejscript.</p>
            <p>To learn more, please read the rest of the <a href="../../../index.html">Ejscript Documentation</a> and
            the <a href="../../../ref/ejs/webArchitecture.html">Ejscript Web Framework Architecture</a>. You may also
            like to ask questions at the <a href="http://www.ejscript.org/forum/">Ejscript Support Forum</a>.</p>
        </div>
    </div>
<!-- BeginDsi "dsi/bottom.html" -->
	<div class="bottom">
		<p class="footnote"> 
            <a href="../../../product/copyright.html" >&copy; Embedthis Software LLC, 2003-2009. 
            All rights reserved. Embedthis, Ejscript and Appweb are trademarks of Embedthis Software LLC.</a>
		</p>
	</div>
<!-- EndDsi -->
</body>
</html>
